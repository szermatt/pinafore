<svelte:target ref:target/>
<script>
  import {
      isShortcutEvent,
      addToShortcutScope,
      removeFromShortcutScope } from '../../_utils/shortcuts'
  export default {
      data: () => ({scope: null, key: null}),
      oncreate() {
	  let {scope} = this.get()
	  if (scope) {
              addToShortcutScope(scope, this)
          } else if (!this.listener) {
	      console.log('add listener')
	      this.listener = this.onKeyDown.bind(this)
	      window.addEventListener("keydown", this.listener);
	  }
      },
      ondestroy() {
          let {scope} = this.get()
	  if (scope) {
              removeFromShortcutScope(scope, this)
          }
          if (this.listener) {
  	      window.removeEventListener("keydown", this.listener);
          }
      },
      methods: {
	  onKeyDown(event) {
              if (!isShortcutEvent(event)) {
                  return
              }
	      let { key } = this.get()
	      if (event.key != key) {
                  return
              }
	      event.stopPropagation()
	      this.fire('pressed', {
		  key: key,
		  timeStamp: event.timeStamp})
	  }
      }
  };
</script>
